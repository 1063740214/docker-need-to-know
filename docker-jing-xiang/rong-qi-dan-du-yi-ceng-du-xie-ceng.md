---
description: 容器单独一层读写层，容器只读镜像
---

# 容器单独一层读写层

实际中，我们发现一个镜像可以run无数个容器，容器需要读取文件的场景和对应原理是如下\(这里先将这个规则，后续也会去验证下面这些规则\)

1. \(无数据卷和挂载下\)向容器添加文件 文件在容器这层读写层里,容器删除会则删除
2. 读取文件 从上层往下找到镜像层,找到即可返回,复制到容器层读入内存
3. 修改文件 从上层往下找到镜像层,找到即可返回，复制到容器层后修改
4. 删除文件 找到后在容器层记录下删除操作\(后续读取的时候会认为文件不存在\)

容器与镜像关系为下图，实际上还有层init层，后面讲

![](../.gitbook/assets/image%20%2819%29.png)

通过docker ps 的-s选项可以看出容器的size和使用的镜像size大小，这里我用docker命令演示下容器是单独一层读写层和容器死亡数据丢失\(也就是说容器是无状态的\)

![](../.gitbook/assets/image%20%289%29.png)

创建一个容器，在容器里写入1g数据，宿主机的可用容量减少1G，docker的overlay2存储目录记录了下这个文件，但是删除后文件也被删除了。在抽象逻辑上一个容器就是单独一个读写层，而删除容器后这层在宿主机上的落地文件也会被删除。

